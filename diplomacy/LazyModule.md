[Rocket](../Readme.md)/[diplomacy](../diplomacy.md)/[LazyModule](https://github.com/freechipsproject/rocket-chip/blob/master/src/main/scala/diplomacy/LazyModule.scala)
=====================
*Definition of LazyModule: the base for diplomacy and cacke pattern.*

**********************

## abstract class LazyModule
*Module generator. Allow postponed (lazy) module elaboration.*

+ **children** `List[LazyModule]` (protected) list of sub-modules.
+ **parent** `Option[LazyModule]` (protected) parent module.

  > `childran` and `parent` record the module hierarchy with the help of `LazyModule.stack`.<br>
  > For a module hierarchy as : `A{ B{ C, D }, E }`:
  > ~~~
  > A.parent = None  A.children = B, E
  > B.parent = A     B.children = C, D
  > C.parent = B     C.children = ()
  > D.parent = B     D.children = ()
  > E.parent = A     E.children = ()
  > ~~~

+ **nodes** `List[BaseNode]` (protected) all diplomacy nodes (one-level, not recursive) in this LazyModule.
+ **bindings** `List[() => Unit]`<br>
  (protected) The port connection callbacks generated by `InwardNodeImp.connect()` of all nodes in this LazyModule.
+ **info** `SourceInfo` (protected) source information (line number, etc.) for better error/warning messages.
+ **suggestName** `(x:String) => Unit` set the suggested module name to `x`.
+ **findvalname** `lazymodule.stack=>.map(_._1)` find the childNames from parent
+ **moduleName** `() => String` get the module name.
+ **instanceName** `() => String` get the instance name.
+ **name** `() => String` get the class name.
+ **line** `() => String` get source line string.
+ **module** ` => LazyModuleImpLike` get the actual chisel Module implementation.
+ **instantiate** `() => Unit`<br>
  (protected) generate the actual sub-modules (`children`) hardware after all parameters are resolved.
  Also it connect the port connections among sub-modules and ports according to `bindings`.
+ **graphML** `String` (lazy) node connection graph in graphML.
+ **nodeIterator** `(iterfunc: (LazyModule) => Unit) => Unit`<br>
  Apply function `iterfunc` recursively to the whole hierarchy.

### object LazyModule
*Global stack to keep the module hierarchy.*

+ **stack** `List[LazyModule]` (protected) a stack of LazyModules that have not been constructed.
+ **apply** `[T <: LazyModule](bc:T) => bc` a LazyModule wrapper to enforce the LazyModule construction order.

### trait LazyModuleImpLike
*The base trait of all LazyModule implementations.*

~~~scala
sealed trait LazyModuleImpLike extends BaseModule
~~~

+ **wrapper** `LazyModule` (virtual) pointer to the LazyModule.
+ **p** `Parameters` (implicit) configuration from the paired LazyModule.

## abstract class LazyModuleImp
*The normal module definition.*
**_All I/O are bundled together through the `io` variable._**

~~~scala
abstract class LazyModuleImp(val wrapper: LazyModule) extends Module with LazyModuleImpLike {
  wrapper.instantiate()
}
~~~

## abstract class LazyMultiIOModuleImp
*Module definition that allow arbitrary data port deifnitions.*
**_Any variables defined using the `IO()` wrapper are included into the module I/Os._**

~~~scala
abstract class LazyMultiIOModuleImp(val wrapper: LazyModule) extends MultiIOModule with LazyModuleImpLike {
  wrapper.instantiate()
}
~~~

## abstract class LazyRawModuleImp
*Module defintion that allow arbitrary data and clock port definitions.*
**_Any variables defined using the `IO()` wrapper are included into the module I/Os._**
**_Allow multiple clock and reset definitions by using `IO(Input(Clock()))` and `IO(Input(Bool()))`._**
**_The default clock and reset are disabled._**
~~~scala
abstract class LazyRawModuleImp(val wrapper: LazyModule) extends RawModule with LazyModuleImpLike {
  withClockAndReset(Bool(false).asClock, Bool(true)) {
    wrapper.instantiate()
  }
}
~~~


<br><br><br><p align="right">
<sub>
Last updated: 07/08/2017<br>
[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/), &copy; (2017) [Wei Song](mailto:wsong83@gmail.com)<br>
[Apache 2.0](https://github.com/freechipsproject/rocket-chip/blob/master/LICENSE.SiFive), &copy; (2016-2017) SiFive, Inc<br>
[BSD](https://github.com/freechipsproject/rocket-chip/blob/master/LICENSE.Berkeley), &copy; (2012-2014, 2016) The Regents of the University of California (Regents)
</sub>
</p>
